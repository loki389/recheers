# 🚀 推送代码到 GitHub 并部署指南

## 📋 第一步：提交并推送代码到 GitHub

### 步骤 1：添加所有更改的文件

```bash
git add .
```

这会添加所有修改和新文件。

### 步骤 2：提交更改

```bash
git commit -m "添加 KV 存储支持，修复调研问卷提交功能"
```

### 步骤 3：推送到 GitHub

```bash
git push origin main
```

---

## 📋 第二步：关于环境变量

### ⚠️ 重要说明

**环境变量不是在部署时添加的，而是在项目设置中配置的！**

你已经看到了这些环境变量：
- `KV_URL`
- `KV_REST_API_URL`
- `KV_REST_API_TOKEN`
- `KV_REST_API_READ_ONLY_TOKEN`
- `REDIS_URL`

这些已经在 Vercel 的 **Settings → Environment Variables** 中配置好了。

### ✅ 环境变量配置位置

1. **进入 Vercel Dashboard**
   - 访问：https://vercel.com/dashboard
   - 选择你的项目

2. **进入环境变量设置**
   - 点击顶部菜单 **"Settings"**
   - 在左侧菜单中找到 **"Environment Variables"**

3. **查看环境变量**
   - 你应该能看到所有 KV 相关的环境变量
   - 确认它们都设置为 **"All Environments"**（所有环境）

---

## 📋 第三步：重新部署项目

### 方法 A：自动部署（推荐）

当你推送代码到 GitHub 后：
1. Vercel 会自动检测到代码更新
2. 自动开始新的部署
3. 部署完成后，新代码和环境变量都会生效

### 方法 B：手动重新部署

如果需要立即重新部署：

1. **进入 Deployments 页面**
   - 在项目页面点击 **"Deployments"** 标签

2. **重新部署**
   - 找到最新的部署
   - 点击右侧的 **"..."** 菜单（三个点）
   - 选择 **"Redeploy"**
   - 确认重新部署

3. **等待部署完成**
   - 通常需要 1-2 分钟
   - 查看部署日志确认成功

---

## 📋 完整流程总结

### 1. 推送代码到 GitHub

```bash
# 在项目目录执行
cd E:\LTNS

# 添加所有文件
git add .

# 提交更改
git commit -m "添加 KV 存储支持，修复调研问卷提交功能"

# 推送到 GitHub
git push origin main
```

### 2. 等待 Vercel 自动部署

- 推送代码后，Vercel 会自动开始部署
- 等待 1-2 分钟
- 查看部署状态

### 3. 验证部署成功

- 进入 Vercel Dashboard → Deployments
- 确认最新部署状态为 **"Ready"**（绿色）
- 查看日志确认没有错误

### 4. 测试功能

- 访问部署的网站
- 尝试提交调研问卷
- 检查是否成功

---

## 🔍 验证环境变量

### 检查环境变量是否生效

1. **查看部署日志**
   - 进入 Deployments → 最新部署 → Functions
   - 查找日志中的：`"Using Vercel KV with env vars"`
   - 如果看到这个，说明环境变量已正确加载

2. **检查函数日志**
   - 尝试提交调研问卷
   - 查看 Functions 日志
   - 查找是否有错误信息

---

## ⚠️ 常见问题

### 问题 1：推送代码失败

**解决**：
- 检查网络连接
- 确认 GitHub 账户权限
- 尝试：`git pull origin main` 先拉取最新代码

### 问题 2：Vercel 没有自动部署

**解决**：
- 检查 GitHub 仓库是否已连接到 Vercel
- 检查 Vercel 项目的 GitHub 集成设置
- 手动触发重新部署

### 问题 3：环境变量未生效

**解决**：
- 确认环境变量已添加到所有环境（Production、Preview、Development）
- 重新部署项目
- 检查环境变量值是否正确

---

## 🎉 完成！

完成后，你的网站应该能够：
- ✅ 接收用户提交的调研问卷
- ✅ 将数据保存到 Vercel KV
- ✅ 实时更新数据面板

如果遇到问题，请查看 Vercel 部署日志获取详细错误信息。

